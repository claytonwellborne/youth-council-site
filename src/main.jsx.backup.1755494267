import React from 'react'
import PressHub from './pages/admin/press/PressHub';
import PressEditor from './pages/admin/press/PressEditor';
import ReactDOM from 'react-dom/client'
import { HashRouter, Routes, Route, Navigate, Outlet } from 'react-router-dom'
import './index.css'

/* Public */
import Navbar from './components/Navbar'
import Home from './pages/Home'
import About from './pages/About'
import Ambassador from './pages/Ambassador'
import Contact from './pages/Contact'

/* Press (public) */
import Press from './pages/press/Press'
import PressPost from './pages/press/PressPost'

/* Admin guards + layout */
import AdminGuard from './components/AdminGuard'
import RoleGuard from './components/admin/RoleGuard'
import AdminLayout from './components/admin/AdminLayout'

/* Admin pages */
import Login from './pages/admin/Login'
import Overview from './pages/admin/Overview'
import Directory from './pages/admin/Directory'
import Applications from './pages/admin/Applications'
import Resources from './pages/admin/Resources'
import Executive from './pages/admin/Executive'
import ProfileSettings from './pages/admin/ProfileSettings'
import AccountSettings from './pages/admin/AccountSettings'
import { AdminProvider } from './components/admin/AdminContext'

function PublicLayout(){
  return (
    <div className="min-h-screen flex flex-col">
      <Navbar />
      <main className="flex-1">
        <Outlet />
      </main>
    </div>
  );
}

function App() {
  return (
    <AdminProvider>
      <HashRouter>
        <Routes>
          {/* Public site */}
          <Route element={<PublicLayout />}>
            <Route path="/" element={<Home />} />
            <Route path="/home" element={<Navigate to="/" replace />} />
            <Route path="/about" element={<About />} />
            <Route path="/ambassador" element={<Ambassador />} />
            <Route path="/contact" element={<Contact />} />
            {/* legacy redirects */}
            <Route path="/programs" element={<Navigate to="/ambassador" replace />} />
            <Route path="/apply" element={<Navigate to="/ambassador#apply" replace />} />
            {/* press */}
            <Route path="/press" element={<Press />} />
            <Route path="/press/:slug" element={<PressPost />} />
          </Route>

          {/* Admin auth */}
          <Route path="/admin/login" element={<Login />} />

          {/* Admin app (no public navbar) */}
          <Route
            path="/admin"
            element={
              <AdminGuard>
                <AdminLayout />
              </AdminGuard>
            }
          >
            <Route index element={<Overview />} />
            <Route
              path="directory"
              element={
                <RoleGuard allow={['executive_director','chief_of_staff','vp_membership','vp_finance','vp_pr','regional_coordinator']}>
                  <Directory />
                </RoleGuard>
              }
            />
            <Route
              path="applications"
              element={
                <RoleGuard allow={['executive_director','chief_of_staff','vp_membership','regional_coordinator']}>
                  <Applications />
                </RoleGuard>
              }
            />
            <Route
              path="resources"
              element={
                <RoleGuard allow={['executive_director','chief_of_staff','vp_membership','vp_finance','vp_pr','regional_coordinator']}>
                  <Resources />
                </RoleGuard>
              }
            />
            <Route
              path="press"
              element={
                <RoleGuard allow={['executive_director','chief_of_staff','vp_pr']}>
                  <PressEditor />
                </RoleGuard>
              }
            />
            <Route
              path="executive"
              element={
                <RoleGuard allow={['executive_director','chief_of_staff']}>
                  <Executive />
                </RoleGuard>
              }
            />

            {/* Settings group */}
            <Route path="settings" element={<Navigate to="settings/profile" replace />} />
            <Route
              path="settings/profile"
              element={
                <RoleGuard allow={['executive_director','chief_of_staff','vp_membership','vp_finance','vp_pr','regional_coordinator','ambassador']}>
                  <ProfileSettings />
                </RoleGuard>
              }
            />
            <Route
              path="settings/account"
              element={
                <RoleGuard allow={['executive_director','chief_of_staff','vp_membership','vp_finance','vp_pr','regional_coordinator','ambassador']}>
                  <AccountSettings />
                </RoleGuard>
              }
            />
          </Route>

          {/* Fallback */}

            <Route path="/admin/press" element={<AdminGuard><PressHub /></AdminGuard>} />
        <Route path="/admin/press" element={<AdminGuard><PressHub /></AdminGuard>} />

          <Route path="*" element={<Navigate to="/" replace />} />
  <Route path="/admin/press" element={<AdminGuard><AdminLayout><PressHub/></AdminLayout></AdminGuard>} />\n  <Route path="/admin/press" element={<AdminGuard><AdminLayout><PressEditor/></AdminLayout></AdminGuard>} />\n</Routes>
      </HashRouter>
    </AdminProvider>
  )
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />)
